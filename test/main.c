#include "mes_savgol.h"
#include "mqs_def.h"
#include <stdlib.h>
#include <stdio.h>

int main() {
    double dataset[] = { 10.622701, 10.685064, 10.811692, 10.688583, 10.887390, 10.797409, 10.746269, 10.811608, 10.902945, 10.780086, 10.749742, 10.908122, 10.814869, 10.828547, 10.887683, 10.728690, 10.833145, 11.067073, 11.043278, 11.039386, 11.091691, 11.153873, 11.114600, 11.036674, 11.213064, 11.309932, 11.105683, 11.212055, 11.324126, 11.194699, 11.353987, 11.350740, 11.292644, 11.442810, 11.439925, 11.482235, 11.530317, 11.600945, 11.619031, 11.400206, 11.753139, 11.648222, 11.781803, 11.797832, 11.739770, 11.941082, 11.828091, 12.157527, 12.096933, 12.110010, 12.206010, 12.388506, 12.260824, 12.648261, 12.705714, 12.722179, 12.754862, 12.893028, 13.159175, 13.183230, 13.311389, 13.298972, 13.261604, 13.694345, 13.771741, 14.001879, 14.189768, 14.511730, 14.359793, 14.638225, 14.824602, 14.914421, 14.997834, 15.684181, 15.781509, 16.275709, 16.599232, 16.719099, 17.214252, 17.533026, 17.963692, 18.583456, 18.788620, 19.200493, 19.648212, 20.243040, 20.929434, 21.259766, 21.952223, 22.503075, 23.370432, 24.918806, 25.171230, 27.065788, 27.180111, 27.787876, 28.998455, 29.525824, 31.179409, 31.490416, 32.487705, 34.209385, 35.017632, 35.803844, 36.751629, 37.337452, 38.083050, 38.731632, 39.145710, 39.097286, 39.118252, 38.600292, 38.594673, 38.143532, 36.851486, 36.215759, 35.285809, 33.144527, 31.749477, 30.509886, 29.429501, 28.553759, 27.620716, 25.907400, 25.577999, 24.609949, 23.476007, 22.677389, 21.517937, 21.161259, 19.931110, 19.942099, 18.975761, 18.567039, 18.164619, 17.428867, 17.208427, 17.286226, 16.729990, 16.287188, 16.051325, 15.796345, 15.456290, 15.405236, 14.895143, 14.795584, 14.395524, 14.369744, 14.010384, 13.941030, 13.790119, 13.663849, 13.656402, 13.493700, 13.104727, 12.886893, 12.890328, 13.091658, 12.860380, 12.800608, 12.601340, 12.548893, 12.445310, 12.444828, 12.377852, 12.103253, 12.114568, 12.138745, 11.998631, 11.788012, 11.794188, 11.952522, 11.677851, 11.750690, 11.713306, 11.678294, 11.438836, 11.444407, 11.432587, 11.364266, 11.434116, 11.342859, 11.238228, 11.103382, 11.367911, 11.148427, 11.157647, 11.231358, 11.171824, 11.181418, 11.243023, 11.033014, 10.952828, 10.881493, 11.138855, 10.950686, 11.074336, 10.794726, 11.107287, 10.876784, 11.072885, 10.905889, 11.024071, 10.864059, 11.051531, 10.795092, 10.803169, 10.591374, 10.662008, 10.885164, 10.807120, 10.753461, 10.795931, 10.841900, 10.787424, 10.814193, 10.802969, 10.701277, 10.820682, 10.546778, 10.653350, 10.769685, 10.535284, 10.776764, 10.739217, 10.612684, 10.572164, 10.659692, 10.502118, 10.433316, 10.652619, 10.645733, 10.507947, 10.556618, 10.502070, 10.555065, 10.527785, 10.578192, 10.527130, 10.606975, 10.712130, 10.536406, 10.500002, 10.470071, 10.454396, 10.430950, 10.430219, 10.607625, 10.394053, 10.582440, 10.461887, 10.356397, 10.505668, 10.381385, 10.469771, 10.520262, 10.387793, 10.577419, 10.352968, 10.294890, 10.395078, 10.471552, 10.474617, 10.434118, 10.316442, 10.437953, 10.448010, 10.480718, 10.353670, 10.356996, 10.482037, 10.413630, 10.382499, 10.249657, 10.332000, 10.422174, 10.319706, 10.310604, 10.388857, 10.375589, 10.374058, 10.274459, 10.416360, 10.465050, 10.250622, 10.524909, 10.381805, 10.324562, 10.360604, 10.378771, 10.438423, 10.272150, 10.335931, 10.437474, 10.341777, 10.444112, 10.348996, 10.422782, 10.275411, 10.371153, 10.290133 };
    size_t dataSize = sizeof(dataset)/sizeof(dataset[0]);
    
    MqsRawDataPoint_t rawData[501];
    for (int i = 0; i < 501; ++i) {
        rawData[i].phaseAngle = dataset[i];
        rawData[i].impedance = 0.0;  // You can set the impedance to a default value
    }
    MqsRawDataPoint_t filteredData[501] = {0.0};

    mes_SavgolFilter(rawData, dataSize, filteredData);
    
    // Output or use the filtered data
    printf("yourSavgolData = [");
    for(int i = 0; i < dataSize; ++i) {
   
        //printf("%d. %f, ", i, ApplyFilterAtPoint(dataset, dataSize, g_halfWindowSize, g_targetPoint, filter, i));
        //printf("%f, ", ApplyFilterAtPoint(dataset, dataSize, g_halfWindowSize, g_targetPoint, filter, i));
        //printf("%d. %f, ", i, filteredData[i]);
        if(i == dataSize - 1){
            printf("%f", filteredData[i].phaseAngle);
        }else{
            printf("%f, ", filteredData[i].phaseAngle);
        }
        
        
        //printf("%d. %f, ", i, filteredData[i].phaseAngle);
    }
    printf("];\n");
    
    cleanupFilterInstance();
    return 0;
}